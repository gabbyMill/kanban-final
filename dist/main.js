(()=>{const e=document.querySelectorAll("ul");localStorage.tasks||localStorage.setItem("tasks",'{"todo": [],"in-progress": [],"done": []}');const t=JSON.parse(localStorage.getItem("tasks"));function n(){const n=[...e];for(let e=0;e<n.length;e++){let o=n[e].classList[0].split("-tasks")[0];for(let s in t)if(s.split("-").join("")===o.split("-").join("")){const o=[...n[e].querySelectorAll("li")];t[s]=[],o.forEach((e=>{t[s].push(e.textContent)}))}localStorage.setItem("tasks",JSON.stringify(t))}}function o(e){e.addEventListener("mouseenter",r),e.addEventListener("dblclick",i),e.addEventListener("dragstart",d),e.addEventListener("dragend",u)}!function(t){const n=[...e].map((e=>e.className.split("-tasks")[0]));for(let o in t)for(let s=0;s<n.length;s++)if(o.split("-").join("")===n[s].split("-").join(""))for(let n=0;n<t[o].length;n++){const r=l(t[o][n],["task"]);e[s].append(r)}}(t);const s=document.querySelectorAll("li");function r(t){document.querySelectorAll("li").forEach((e=>e.addEventListener("mouseleave",(()=>{document.removeEventListener("keydown",s)}))));const o=["1","2","3"];function s(s){const r={};r[s.key]=!0,document.addEventListener("keydown",(function(s){if(r.Alt&&o.includes(s.key)){switch(s.key){case"1":e[0].prepend(t.target);break;case"2":e[1].prepend(t.target);break;case"3":e[2].prepend(t.target)}n()}})),document.addEventListener("keyup",(e=>{r[e.key]=!1}))}"mouseenter"===t.type&&document.addEventListener("keydown",s)}function a(e){return e.target.closest("section").id.split("-section")[0]}function c(e){const t=document.querySelector("#search"),s=[...e.target.classList];if("keydown"!==e.type&&!s.includes("bold")&&!s.includes("underline")&&!e.target.closest("button").id.includes("submit"))return;const r=a(e),c=document.querySelector(`#add-${r}-task`);if(c.value.replace(/\s/g,"").length<1)return void alert("You forgot to fill out the box");const i=l(c.value,["task"]);c.value.includes(t.value)?i.className="list-item task":i.className="hidden",o(i),[...e.target.classList].includes("bold")&&i.classList.add("bold-font"),[...e.target.classList].includes("underline")&&i.classList.add("underlined"),document.querySelector(`.${r}-tasks`).prepend(i),n(),c.value=""}function l(e,t=[]){const n=document.createElement("li");return n.append(e),n.classList=t.join(" "),n.setAttribute("draggable","true"),n}function i(e){e.target.addEventListener("blur",(function(o){let s=a(o);"to-do"===s&&(s="todo"),t[s].splice(t[s].indexOf(n),1,o.target.textContent),localStorage.setItem("tasks",JSON.stringify(t)),e.target.setAttribute("contenteditable","false")})),e.target.setAttribute("contenteditable","true"),e.target.focus();const n=e.target.textContent}function d(e){e.target.classList.add("dragging")}function u(e){e.target.classList.remove("dragging")}let g;function f(e){"Enter"===e.key&&c(e)}function m(){const e=document.querySelector("#container"),t=document.createElement("img");return t.className="loader",t.src="../gifs/loader.gif",t.alt="image of loader",document.body.insertBefore(t,e),t}s.forEach((e=>{o(e)})),document.querySelectorAll("button").forEach((e=>e.addEventListener("click",c))),document.querySelector("#search").addEventListener("input",(function(e){document.querySelectorAll("li").forEach((t=>{t.textContent.toLocaleLowerCase().includes(e.target.value.toLocaleLowerCase())?t.className="task list-item":t.className="hidden"}))})),s.forEach((e=>{e.addEventListener("dragstart",(()=>{e.classList.add("dragging")}))})),s.forEach((e=>{e.addEventListener("dragend",(()=>{e.classList.remove("dragging")}))})),e.forEach((e=>{e.addEventListener("dragover",(function(t){t.preventDefault();const o=function(e,t){return[...e.querySelectorAll(".task:not(.dragging)")].reduce(((e,n)=>{const o=n.getBoundingClientRect(),s=t-o.top-o.height/2;return s<0&&s>e.offset?{offset:s,element:n}:e}),{offset:-1/0}).element}(e,t.clientY),s=document.querySelector(".dragging");"null"==o?e.append(o):"trash-container"===e.className?s&&s.remove():e.insertBefore(s,o),n()}))})),document.querySelectorAll(".color").forEach((e=>{e.addEventListener("click",(e=>{const t=document.querySelector("#picker");t.style="display: flex;",g=e.target.closest("section"),setTimeout((()=>{t.style="display: none;"}),5e3)}))})),new iro.ColorPicker("#picker",{width:90}).on("color:change",(e=>{g.style=`background-color: ${e.hexString}`})),document.querySelectorAll("input").forEach((e=>{e.addEventListener("focus",(t=>{t.target!==document.querySelector("#search")&&e.addEventListener("keydown",f)}))})),document.querySelectorAll(".bold").forEach((e=>{e.addEventListener("click",c)})),document.querySelectorAll(".underline").forEach((e=>{e.addEventListener("click",c)})),document.querySelector("#load-btn").addEventListener("click",(async function(){try{const e=m(),t="https://json-bins.herokuapp.com/bin/614afda34021ac0e6c080cc9",n=await fetch(t,{method:"Get",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!n.ok)throw alert(n.status),`HTTP Error ${n.status}`;const o=await n.json();if(localStorage.tasks===o.tasks)return e.remove();console.log(localStorage),localStorage.setItem("tasks",JSON.stringify(o.tasks)),e.remove(),location.reload()}catch(e){console.log(e)}})),document.querySelector("#save-btn").addEventListener("click",(async function(){try{const{tasks:e}=localStorage,t=m(),n="https://json-bins.herokuapp.com/bin/614afda34021ac0e6c080cc9",o=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:JSON.parse(e)})});if(!o.ok)throw alert(o.status),`HTTP ERROR ${o.status}`;t.remove()}catch(e){console.log(e)}}))})();